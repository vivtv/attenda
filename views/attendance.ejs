<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - University Attendance System</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-graduation-cap"></i>
                <span>University Attendance</span>
            </div>
            <div class="nav-links">
                <a href="/courses" class="nav-link">
                    <i class="fas fa-book"></i> Courses
                </a>
                <a href="/reports" class="nav-link">
                    <i class="fas fa-chart-bar"></i> Reports
                </a>
                <div class="nav-user">
                    <i class="fas fa-user"></i>
                    <span><%= instructorName %></span>
                </div>
                <form action="/auth/logout" method="POST" class="logout-form">
                    <button type="submit" class="btn btn-outline">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </form>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
<div class="page-header">
    <div class="header-content">
        <div>
            <h1>
                <i class="fas fa-check-circle"></i>
                Attendance - <%= course.course_name %>
            </h1>
            <p>Course: <%= course.course_code %> | Date: <%= date %></p>
        </div>
        <div class="header-actions">
            <a href="/courses" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i>
                Back to Courses
            </a>
        </div>
    </div>
</div>

<% if (success) { %>
    <div class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        <%= success %>
    </div>
<% } %>

<% if (error) { %>
    <div class="alert alert-error">
        <i class="fas fa-exclamation-circle"></i>
        <%= error %>
    </div>
<% } %>

<div class="attendance-container">
    <form action="/attendance/<%= course.id %>" method="POST" id="attendanceForm">
        <div class="attendance-header">
            <div class="date-selector">
                <label for="date">
                    <i class="fas fa-calendar-alt"></i>
                    Date:
                </label>
                <input 
                    type="date" 
                    id="date" 
                    name="date" 
                    value="<%= date %>" 
                    onchange="changeDate()"
                    max="<%= new Date().toISOString().split('T')[0] %>"
                >
            </div>
            
            <div class="bulk-actions">
                <button type="button" onclick="markAllPresent()" class="btn btn-outline btn-sm">
                    <i class="fas fa-check"></i> Mark All Present
                </button>
                <button type="button" onclick="markAllAbsent()" class="btn btn-outline btn-sm">
                    <i class="fas fa-times"></i> Mark All Absent
                </button>
            </div>
        </div>

        <div class="students-table">
            <table>
                <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Present</th>
                        <th>Absent</th>
                    </tr>
                </thead>
                <tbody>
                    <% students.forEach(student => { %>
                        <tr>
                            <td><%= student.student_id %></td>
                            <td><%= student.first_name %> <%= student.last_name %></td>
                            <td><%= student.email %></td>
                            <td class="status-cell">
                                <input 
                                    type="radio" 
                                    name="attendance[<%= student.id %>]" 
                                    value="present"
                                    id="present_<%= student.id %>"
                                    <%= student.status === 'present' ? 'checked' : '' %>
                                >
                                <label for="present_<%= student.id %>" class="status-label status-present">
                                    <i class="fas fa-check"></i>
                                </label>
                            </td>
                            <td class="status-cell">
                                <input 
                                    type="radio" 
                                    name="attendance[<%= student.id %>]" 
                                    value="absent"
                                    id="absent_<%= student.id %>"
                                    <%= student.status === 'absent' ? 'checked' : '' %>
                                >
                                <label for="absent_<%= student.id %>" class="status-label status-absent">
                                    <i class="fas fa-times"></i>
                                </label>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i>
                Save Attendance
            </button>
            
            <button type="button" onclick="generateReport()" class="btn btn-secondary">
                <i class="fas fa-file-alt"></i>
                Generate Report
            </button>
        </div>
    </form>
</div>

<% if (students.length === 0) { %>
    <div class="empty-state">
        <i class="fas fa-users"></i>
        <h3>No students enrolled</h3>
        <p>No students are enrolled in this course yet.</p>
    </div>
<% } %>

<script>
function changeDate() {
    const newDate = document.getElementById('date').value;
    window.location.href = `/attendance/<%= course.id %>?date=${newDate}`;
}

function markAllPresent() {
    const presentRadios = document.querySelectorAll('input[value="present"]');
    presentRadios.forEach(radio => radio.checked = true);
}

function markAllAbsent() {
    const absentRadios = document.querySelectorAll('input[value="absent"]');
    absentRadios.forEach(radio => radio.checked = true);
}

function generateReport() {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/generate-report/<%= course.id %>';
    
    const dateInput = document.createElement('input');
    dateInput.type = 'hidden';
    dateInput.name = 'date';
    dateInput.value = document.getElementById('date').value;
    
    form.appendChild(dateInput);
    document.body.appendChild(form);
    form.submit();
}
</script>

        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 University Attendance Tracking System. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Auto-hide alerts after 5 seconds
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            });
        }, 5000);
    </script>
</body>
</html>
